<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="alternate" type="application/rss+xml" href="/releases/rss.xml" title="Technical Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/releases/atom.xml" title="Technical Documentation Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SQZ02Y9Z9X"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-SQZ02Y9Z9X",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Technical Documentation" href="/opensearch.xml"><title data-rh="true">C++ Live Weight Reader Tutorial | Technical Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://datalogic.github.io/opos/develop/tutorialcppscale"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="C++ Live Weight Reader Tutorial | Technical Documentation"><meta data-rh="true" name="description" content="&lt;img src="><meta data-rh="true" property="og:description" content="&lt;img src="><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://datalogic.github.io/opos/develop/tutorialcppscale"><link data-rh="true" rel="alternate" href="https://datalogic.github.io/opos/develop/tutorialcppscale" hreflang="en"><link data-rh="true" rel="alternate" href="https://datalogic.github.io/opos/develop/tutorialcppscale" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QFZ97LXSUQ-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.cec666f8.css">
<link rel="preload" href="/assets/js/runtime~main.e2f337d0.js" as="script">
<link rel="preload" href="/assets/js/main.ccfced16.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><div class="announcementBar_IbjG" style="background-color:#002592;color:#ffffff" role="banner"><div class="announcementBarPlaceholder_NC_W"></div><div class="announcementBarContent_KsVm">MAUI / Xamarin SDK 1.32 is <a target="_blank" href="/releases">now available</a></div><button type="button" class="clean-btn close announcementBarClose_FG1z" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/homepage/datalogic.svg" alt="Datalogic Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/homepage/datalogic-dark.svg" alt="Datalogic Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Documentation</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Configuration</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/scan2deploy/studio/">Scan2Deploy Studio</a></li><li><a class="dropdown__link" href="/aeqrdoc/">Android Enterprise QR Code Generator</a></li><li><a class="dropdown__link" href="/oemconfig/">OEMConfig</a></li><li><a class="dropdown__link" href="/wifiqrdoc/">Wi-Fi QR Code Generator</a></li><li><a class="dropdown__link" href="/dxu/">DXU</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">SDKs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/android/">Android SDK</a></li><li><a class="dropdown__link" href="/javascript/">JavaScript SDK</a></li><li><a class="dropdown__link" href="/xamarin/">MAUI / Xamarin SDK</a></li><li><a class="dropdown__link" href="/cordova/">Cordova SDK</a></li><li><a class="dropdown__link" href="/reactnative/">React Native SDK</a></li><li><a class="dropdown__link" href="/hhs/">Handheld Core SDK</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Utilities</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/launcher/">Datalogic Launcher</a></li><li><a class="dropdown__link" href="/browser/">Datalogic Enterprise Browser</a></li><li><a class="dropdown__link" href="/logger/">Datalogic Logger</a></li><li><a class="dropdown__link" href="/wifiguard/">Datalogic WiFi Guard</a></li><li><a class="dropdown__link" href="/m10ethcradle/">Memor 10 Ethernet Adapter Service Utility</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Windows CE</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/scan2deploy-ce/">Scan2Deploy CE</a></li><li><a class="dropdown__link" href="/dxu/">DXU</a></li><li><a class="dropdown__link" href="/ce/">Windows CE SDK</a></li><li><a class="dropdown__link" href="/cesync/">Datalogic CE Sync</a></li><li><a class="dropdown__link" href="/usblan/">USBLAN</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">POS</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/javapos/overview">JavaPOS</a></li><li><a class="dropdown__link" href="/opos/overview">OPOS</a></li></ul></div><a class="navbar__item navbar__link" href="/releases/">Releases</a><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO menuWithAnnouncementBar_x19h"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">OPOS</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/overview">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/opos/distribution/overview">Distribution</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/distribution/distcomponents">Distribution Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/distribution/installing">Installing Datalogic OPOS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/distribution/filesref">Installed Files (OPOS)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/distribution/uninstalling">Uninstalling</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0">Configuration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/opos/configref/overview">Required Configuration Files</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/configref/parsertablecsv">ParserTable.csv</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/configref/ecicodepagecsv">ECICodePage.csv</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/configref/prfparserjson">prf_parser.json</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/configref/registrysettings">OPOS Registry Settings</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0">View and Edit</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/configref/propertieseditor">OPOS Properties Editor</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" tabindex="0">Developing</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/develop/appintegrate">Application Integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/develop/tutorialintro">Introduction to the OPOS Tutorials</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" tabindex="0">C++ Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/develop/tutorialcppscanner">C++ Barcode Reader Tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/opos/develop/tutorialcppscale">C++ Live Weight Reader Tutorial</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0">C# Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/develop/tutorialcsharpscanner">C# Barcode Reader Tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/develop/tutorialcsharpscale">C# Live Weight Reader Tutorial</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/develop/datalogicoposexamples">Datalogic OPOS Examples on GitHub</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a href="https://github.com/datalogic/OPOSSamples" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>Datalogic OPOSSamples repository<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0">Remote Management</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/dlrmus/">DLRMUS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0">Files</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/dlrmus/propertiesjson">properties.json</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/configref/prfparserjson">prf_parser.json</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0">Management</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/dlrmus/installing">Installing (DLRMUS)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/dlrmus/uninstalling">Uninstalling (DLRMUS)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/opos/dlrmus/installedfiles">Installed Files (DLRMUS)</a></li></ul></li></ul></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_cwdi"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_xORG"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">🏠</a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">OPOS</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Developing</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">C++ Tutorials</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/opos/develop/tutorialcppscale">C++ Live Weight Reader Tutorial</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>C++ Live Weight Reader Tutorial</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><p>In this tutorial, we will be creating a simple console application in C++ that opens, claims and enables a scale device and provides a live weight readings of items placed on the scale platter. This tutorial only covers a very basic aspect of development using OPOS with C++, but should suffice as a starting point for any application that looks to read weights from a Datalogic scale device.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h2><p>Developing an application for a Datalogic scale device requires you to first have Datalogic&#x27;s OPOS installed. The OPOS installer ensures the required ActiveX Controls are registered and any supporting files are present.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="creating-a-project">Creating a project<a class="hash-link" href="#creating-a-project" title="Direct link to heading">​</a></h2><ol><li>Using Visual Studio 2019, navigate to <strong>File &gt; New &gt; Project ...</strong><img src="/img/opos/develop/cpp/filenewproject.png" style="max-width:750px;max-height:750px"></li></ol><ol start="2"><li><p>In the <strong>Create a new project</strong> dialog, set the filter to <strong>C++</strong>, select <strong>Console App</strong> and select <strong>Next</strong></p><img src="/img/opos/develop/cpp/createnewproject.png" style="max-width:750px;max-height:750px"></li><li><p>In the <strong>Configure your new project</strong> dialog, declare your <strong>Project name</strong>, <strong>Location</strong> and <strong>Solution name</strong> as desired and then select <strong>Create</strong>.</p><img src="/img/opos/develop/cpp/scale/configurenewproject.png" style="max-width:750px;max-height:750px"></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="exposing-opos-control-objects">Exposing OPOS control objects<a class="hash-link" href="#exposing-opos-control-objects" title="Direct link to heading">​</a></h2><p>The very first step is to reference the scale ActiveX Control by its ProgID (Programmatic Identifier) using the <code>#import</code> directive.</p><div class="codeBlockContainer_I0IT language-c++ theme-code-block"><div class="codeBlockContent_wNvx c++"><pre tabindex="0" class="prism-code language-c++ codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#import &quot;progid:OPOS.Scale&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Compiling the project at this point, the <code>#import</code> directive generates two files in your <code>$(Configuration)</code> folder (i.e. Debug/Release). <code>OPOSScale.tlh</code> is the Type Library Header and <code>OPOSScale.tli</code> is the Type Library Interface. These files contain generated type information that bridges the COM object&#x27;s interface with C++ language constructs.</p><p>While this makes the compiler aware of the COM object you&#x27;re accessing, you&#x27;ll likely find it helpful to make the Visual Studio IDE aware of of it as well; to do this you&#x27;ll need to import the type library. Inside <code>OPOSScale.tlh</code> are a series of forward declared structs. The first struct reads: </p><div class="codeBlockContainer_I0IT language-c++ theme-code-block"><div class="codeBlockContent_wNvx c++"><pre tabindex="0" class="prism-code language-c++ codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct __declspec(uuid(&quot;&lt;some-unique-identifier&gt;&quot;))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/* LIBID */ __OposScale_CCO;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Adding <code>#import &quot;libid:&lt;some-unique-identifier&gt;&quot;</code> to your project will inform the IDE of the COM interface and everything in the namespace OposScale_CCO, but is not required for compilation. </p><p>Now your application should look similar to:</p><div class="codeBlockContainer_I0IT language-c++ theme-code-block"><div class="codeBlockContent_wNvx c++"><pre tabindex="0" class="prism-code language-c++ codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// This import statement causes generation of OPOSScale.tlh and OPOSScale.tli</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#import &quot;progid:OPOS.Scale&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// This import statement informs the IDE of the COM interface and everything in the</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// namespace OposScale_CCO, but is not required for compilation.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#import &quot;libid:ccb90170-b81e-11d2-ab74-0040054c3719&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="creating-the-opos-scale-interface">Creating the OPOS scale interface<a class="hash-link" href="#creating-the-opos-scale-interface" title="Direct link to heading">​</a></h2><p><code>CoInitializeEx()</code> must be called near the start of program to load and initialize the COM library and <code>CoUninitialize()</code> must be called near the end of the program to unload the COM library.</p><p>The scale is implemented using the smart pointer <code>IOPOSScalePtr</code> defined in <code>OPOSScale.tlh</code> as <code>_COM_SMARTPTR_TYPEDEF(IOPOSScale, __uuidof(IOPOSScale))</code>, based on the <a href="https://docs.microsoft.com/en-us/cpp/cpp/com-ptr-t-class" target="_blank" rel="noopener noreferrer">_com_ptr_t class</a>.</p><p>An instance of the scale is created by calling <code>_com_ptr_t::CreateInstance(const char *progid)</code> and is release by calling <code>_com_ptr_t::Release()</code> when no longer needed. Failure to release the object can cause problems with an actual POS system.</p><div class="codeBlockContainer_I0IT language-c++ theme-code-block"><div class="codeBlockContent_wNvx c++"><pre tabindex="0" class="prism-code language-c++ codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// This import statement causes generation of OPOSScale.tlh and OPOSScale.tli</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#import &quot;progid:OPOS.Scale&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// This import statement informs the IDE of the COM interface and everything in the</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// namespace OposScale_CCO, but is not required for compilation.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#import &quot;libid:ccb90170-b81e-11d2-ab74-0040054c3719&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Load and initialize the COM library.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CoInitializeEx(NULL, COINIT_APARTMENTTHREADED);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Create a COM object and point to it.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    OposScale_CCO::IOPOSScalePtr scale; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scale.CreateInstance(&quot;OPOS.Scale&quot;); </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // more to come .... </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Release the COM object</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scale.Release(); </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Unload the COM library.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CoUninitialize(); </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="accessing-the-opos-scale-interface">Accessing the OPOS Scale interface<a class="hash-link" href="#accessing-the-opos-scale-interface" title="Direct link to heading">​</a></h2><p>At this point, you are ready to use the <code>scale</code> object. </p><p>The OPOS standard defines a general sequence to access a device:</p><ul><li><strong>open</strong>: open a context to the device</li><li><strong>claim</strong>: claim control over the device</li><li><strong>enable</strong>: enable the device&#x27;s operation</li><li><strong>disable</strong>: disable the device&#x27;s  operation</li><li><strong>release</strong>: release control over the device</li><li><strong>close</strong>: close the context to the device</li></ul><p>Opening a scale context requires you to reference a <em>device profile</em> (a device profile simply being a name representing a set of parameters relevant to the device). When OPOS is installed, scale profiles are seen as the subkey names installed under the UPOS-specified registry key <code>HKEY_LOCAL_MACHINE\Software\Wow6432Node\OLEforRetail\ServiceOPOS\SCALE</code>. It is your choice whether you want to programmatically obtain the profile names from the registry or to simply hard-code them in your application.</p><p>If the scale context is successfully opened, you can then claim the device, gaining exclusive access to it. And if the device is successfully claimed, you can then enable it to perform subsequent operations.</p><p>Enabling live weight reading requires you to include the header file <code>OposScal.h</code>, found in the distribution (typically under C:\Program Files (x86)\DLSOPOS\Controls\OposScal.h).</p><div class="codeBlockContainer_I0IT language-c++ theme-code-block"><div class="codeBlockContent_wNvx c++"><pre tabindex="0" class="prism-code language-c++ codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;windows.h&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;string&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// For access to scale constants (e.g. SCAL_SN_ENABLED)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &quot;OposScal.h&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// This import statement causes generation of OPOSScale.tlh and OPOSScale.tli</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#import &quot;progid:OPOS.Scale&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// This import statement informs the IDE of the COM interface and everything in the</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// namespace OposScale_CCO, but is not required for compilation.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#import &quot;libid:ccb90170-b81e-11d2-ab74-0040054c3719&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Load and initialize the COM library.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CoInitializeEx(NULL, COINIT_APARTMENTTHREADED);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Create a COM object and point to it.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    OposScale_CCO::IOPOSScalePtr scale; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scale.CreateInstance(&quot;OPOS.Scale&quot;); </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Open a context with the scale (e.g. &quot;USBScale&quot;).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    std::string profileName(&quot;&lt;your selected profile&gt;&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scale-&gt;Open(profileName.c_str());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Claim control of the scale using a 1000 millisecond timeout.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scale-&gt;ClaimDevice(1000L);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (scale-&gt;Claimed)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Enable the device.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        scale-&gt;DeviceEnabled = true;        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Tell the scale we intend to perform &quot;live&quot; weighing.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        scale-&gt;StatusNotify = SCAL_SN_ENABLED;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Enable transmission of event data.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        scale-&gt;DataEventEnabled = true;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        //</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // more to come .... </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        //</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Disable, release and close the scale.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        scale-&gt;DeviceEnabled = false;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        scale-&gt;ReleaseDevice();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        scale-&gt;Close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Release the COM object</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scale.Release(); </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Unload the COM library.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CoUninitialize(); </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="creating-a-sink-for-the-scale">Creating a sink for the scale<a class="hash-link" href="#creating-a-sink-for-the-scale" title="Direct link to heading">​</a></h2><p>To make the application useful, we must create a scale <em>sink</em> (an object that receives input from the device).</p><ol><li><p>Using the Visual Studio 2019 <strong>Solution Explorer</strong>, right mouse click <strong>Header Files</strong></p><img src="/img/opos/develop/cpp/scale/addnewh_a.png" style="max-width:750px;max-height:750px"></li><li><p>And when the dialog appears add a header file named ScaleSink.h</p><img src="/img/opos/develop/cpp/scale/addnewh_b.png" style="max-width:750px;max-height:750px"></li><li><p>Using the Visual Studio 2019 <strong>Solution Explorer</strong>, right mouse click <strong>Source Files</strong></p><img src="/img/opos/develop/cpp/scale/addnew_a.png" style="max-width:750px;max-height:750px"></li><li><p>And when the dialog appears add a source file named ScaleSink.cpp</p><img src="/img/opos/develop/cpp/scale/addnew_b.png" style="max-width:750px;max-height:750px"></li></ol><p>The sink provides callback functions for use by the COM object. The callback functions provide implementations for the virtual methods of</p><ul><li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms221608(v=vs.85)" target="_blank" rel="noopener noreferrer">IDispatch</a></li><li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms680509(v=vs.85)" target="_blank" rel="noopener noreferrer">IUnknown</a></li></ul><p>and the <em>dispatch</em> methods of</p><ul><li>_IOPOSScaleEvents (defined in <code>OPOSScale.tli</code>)</li></ul><p>You will also notice enum ScaleEvent whose values are used by the COM object to map events to the dispatch methods. These will be discussed later in <a href="#idispatch">Implementing IDispatch</a>.</p><p>The scale sink is derived from OposScale_CCO::_IOPOSScaleEvents as follows</p><div class="codeBlockContainer_I0IT language-c++ theme-code-block"><div class="codeBlockContent_wNvx c++"><pre tabindex="0" class="prism-code language-c++ codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ScaleSink.h</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// This import statement causes generation of OPOSScale.tlh and OPOSScale.tli</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#import &quot;progid:OPOS.Scale&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// This import statement informs the IDE of the COM interface and everything in the</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// namespace OposScale_CCO, but is not required for compilation.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#import &quot;libid:ccb90170-b81e-11d2-ab74-0040054c3719&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class ScaleSink: public OposScale_CCO::_IOPOSScaleEvents</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ScaleSink(OposScale_CCO::IOPOSScale &amp;scaleObject)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      : scale(scaleObject)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      , ref(0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // IUnknown methods </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    IFACEMETHODIMP QueryInterface(REFIID riid, void **ppv);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    IFACEMETHODIMP_(ULONG) AddRef();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    IFACEMETHODIMP_(ULONG) Release();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // IDispatch methods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    IFACEMETHODIMP GetTypeInfoCount(UINT *pctinfo);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    IFACEMETHODIMP GetTypeInfo(UINT itinfo, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        LCID lcid, ITypeInfo **iti);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    IFACEMETHODIMP GetIDsOfNames(REFIID riid, LPOLESTR *names, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        UINT size, LCID lcid,DISPID *rgDispId);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    IFACEMETHODIMP Invoke(DISPID dispid, REFIID riid, LCID lcid, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        WORD flags,DISPPARAMS *dispparams, VARIANT *result,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        EXCEPINFO *exceptioninfo, UINT *argerr);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // _IOPOSScaleEvents methods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HRESULT DataEvent(long Status);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HRESULT DirectIOEvent(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long EventNumber,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long *Data,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        BSTR *String);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HRESULT ErrorEvent(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long ResultCode,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long ResultCodeExtended,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long ErrorLocus,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long *ErrorResponse);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HRESULT StatusUpdateEvent(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long Data);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    enum ScaleEvent: DISPID</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Unused   = 0,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Data     = 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        DirectIO = 2,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Error    = 3,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Reserved = 4,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        StatusUpdate = 5,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Count    = 6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">private:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    LONG ref;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    OposScale_CCO::IOPOSScale &amp;scale;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="implementing-iunknown">Implementing IUnknown<a class="hash-link" href="#implementing-iunknown" title="Direct link to heading">​</a></h4><p>IUnknown is inherited by every COM interface. IUnknown has three virtual
methods:</p><ul><li><code>AddRef()</code></li><li><code>QueryInterface()</code></li><li><code>Release()</code></li></ul><p><code>AddRef()</code> and <code>Release()</code> are used for reference counting and <code>QueryInterface()</code> retrieves the supported interfaces of an object. The implementation of IUnknown is often as straight-forward as seen in this tutorial, which is loosely based off of the MSDN article <a href="https://msdn.microsoft.com/en-us/library/office/cc839627.aspx" target="_blank" rel="noopener noreferrer">Implementing IUnknown in C++</a>.</p><div class="codeBlockContainer_I0IT language-c++ theme-code-block"><div class="codeBlockContent_wNvx c++"><pre tabindex="0" class="prism-code language-c++ codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ScaleSink.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &quot;ScaleSink.h&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IFACEMETHODIMP ScaleSink::QueryInterface(REFIID riid, void **ppv)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    *ppv = nullptr;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    IID id = __uuidof(OposScale_CCO::_IOPOSScaleEvents);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HRESULT hr = E_NOINTERFACE;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (riid == IID_IUnknown || riid == IID_IDispatch || riid == id) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        *ppv = static_cast&lt;OposScale_CCO::_IOPOSScaleEvents *&gt;(this);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        AddRef();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        hr = S_OK;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return hr;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IFACEMETHODIMP_(ULONG) ScaleSink::AddRef()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return ++ref;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IFACEMETHODIMP_(ULONG) ScaleSink::Release()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (--ref == 0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        delete this;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return ref;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="implementing-idispatch">Implementing IDispatch<a name="idispatch"></a><a class="hash-link" href="#implementing-idispatch" title="Direct link to heading">​</a></h4><p>IDispatch has four virtual methods:</p><ul><li><code>Invoke()</code></li><li><code>GetIDsOfNames()</code></li><li><code>GetTypeInfo()</code></li><li><code>GetTypeInfoCount()</code></li></ul><p>The COM object calls <code>GetIDsOfNames()</code> to obtain the dispatch id (<code>DISPID</code>) of a single class property or method. The dispatch id is then used by the COM object during subsequent calls to <code>Invoke()</code>. </p><p><code>Invoke()</code> allows the COM object to call the <code>_IOPOSScaleEvents</code> methods of the sink class. The <code>DISPID</code> parameter identifies the method to call and <code>DISPPARAMS</code> contains the values to be passed to the function. </p><p><code>GetTypeInfo()</code> and <code>GetTypeInfoCount()</code> are used to retrieve type information, but provide no value in our case.</p><div class="codeBlockContainer_I0IT language-c++ theme-code-block"><div class="codeBlockContent_wNvx c++"><pre tabindex="0" class="prism-code language-c++ codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ScaleSink.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IFACEMETHODIMP ScaleSink::GetTypeInfoCount(UINT *pctinfo) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    *pctinfo = 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return E_NOTIMPL;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IFACEMETHODIMP ScaleSink::GetTypeInfo(UINT itinfo, LCID lcid, ITypeInfo **iti)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    *iti = nullptr;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return E_NOTIMPL;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IFACEMETHODIMP ScaleSink::GetIDsOfNames(REFIID riid, LPOLESTR *names,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    UINT size, LCID lcid, DISPID *dispids)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (wcscmp(names[0], L&quot;StatusUpdateEvent&quot;) == 0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        dispids[0] = ScaleEvent::StatusUpdate;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    else if (wcscmp(names[0], L&quot;DirectIOEvent&quot;) == 0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        dispids[0] = ScaleEvent::DirectIO;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    else if (wcscmp(names[0], L&quot;ErrorEvent&quot;) == 0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        dispids[0] = ScaleEvent::Error;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    else if (wcscmp(names[0], L&quot;DataEvent&quot;) == 0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        dispids[0] = ScaleEvent::Data;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        dispids[0] = -1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return ((dispids[0] == -1) ? E_NOTIMPL : S_OK);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IFACEMETHODIMP ScaleSink::Invoke(DISPID dispid, REFIID riid, LCID lcid,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    WORD flags, DISPPARAMS *dispparams, VARIANT *result,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    EXCEPINFO *exceptioninfo, UINT *argerr) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (ScaleEvent::StatusUpdate == dispid)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return StatusUpdateEvent(dispparams-&gt;rgvarg[0].lVal);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return S_OK;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="implementing-event-functions">Implementing event functions<a class="hash-link" href="#implementing-event-functions" title="Direct link to heading">​</a></h4><p>With <code>IDispatch</code> implemented the scale sink will invoke its supported events. For the purpose of this tutorial, the scale event data is simply interpreted and printed to the console.</p><div class="codeBlockContainer_I0IT language-c++ theme-code-block"><div class="codeBlockContent_wNvx c++"><pre tabindex="0" class="prism-code language-c++ codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ScaleSink.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">HRESULT ScaleSink::StatusUpdateEvent(long Data)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (Data == SCAL_SUE_STABLE_WEIGHT)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        std::cout &lt;&lt; WeightFormat(scale.ScaleLiveWeight) &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    else if (Data == SCAL_SUE_WEIGHT_UNSTABLE)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        std::cout &lt;&lt; &quot;Scale weight unstable&quot; &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    else if (Data == SCAL_SUE_WEIGHT_ZERO)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        std::cout &lt;&lt; WeightFormat(scale.ScaleLiveWeight) &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    else if (Data == SCAL_SUE_WEIGHT_OVERWEIGHT)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        std::cout &lt;&lt; &quot;Weight limit exceeded.&quot; &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    else if (Data == SCAL_SUE_NOT_READY)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        std::cout &lt;&lt; &quot;Scale not ready.&quot; &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    else if (Data == SCAL_SUE_WEIGHT_UNDER_ZERO)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        std::cout &lt;&lt; &quot;Scale under zero weight.&quot; &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        std::cout &lt;&lt; &quot;Unknown status [&quot; &lt;&lt; Data &lt;&lt; &quot;]&quot; &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return S_OK;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">std::string ScaleSink::WeightFormat(int weight)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    std::string weightStr;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    std::string units = UnitAbbreviation(scale.WeightUnits);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (units.empty())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        weightStr = &quot;Unknown weight unit&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        std::stringstream ss;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ss &lt;&lt; std::fixed &lt;&lt; std::setw(6) &lt;&lt; std::setprecision(3) &lt;&lt; (0.001 * (double)weight) &lt;&lt; &quot; &quot; &lt;&lt; units;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        weightStr = ss.str();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return weightStr;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">std::string ScaleSink::UnitAbbreviation(int units)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    std::string unitStr;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    switch (units)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    case SCAL_WU_GRAM:     unitStr = &quot;gr.&quot;; break;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    case SCAL_WU_KILOGRAM: unitStr = &quot;kg.&quot;; break;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    case SCAL_WU_OUNCE:    unitStr = &quot;oz.&quot;; break;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    case SCAL_WU_POUND:    unitStr = &quot;lb.&quot;; break;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return unitStr;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="connecting-the-scale-and-the-sink">Connecting the scale and the sink<a class="hash-link" href="#connecting-the-scale-and-the-sink" title="Direct link to heading">​</a></h2><p>Now we must inform the scale of the sink. To do this query an <code>IConnectionPointContainer</code> interface by calling
<code>QueryInterface()</code> from the scale. On the connection point container, get the interface of the <code>_IOPOSScaleEvents</code> connection point by calling <code>FindConnectionPoint()</code>. Now a connection can be established between the scale and the sink by calling <code>Advise()</code> on the connection point.</p><p>The following code can be seen in context in the segment <a href="#together">Tying it all together</a>.</p><div class="codeBlockContainer_I0IT language-c++ theme-code-block"><div class="codeBlockContent_wNvx c++"><pre tabindex="0" class="prism-code language-c++ codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">IConnectionPointContainer *cpc;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">scale-&gt;QueryInterface(IID_IConnectionPointContainer, (void **) &amp;cpc);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IConnectionPoint *cp; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cpc-&gt;FindConnectionPoint(__uuidof(OposScale_CCO::_IOPOSScaleEvents), &amp;cp);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cpc-&gt;Release();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ScaleSink *sink = new ScaleSink(*scale);    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DWORD cookie;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cp-&gt;Advise(sink, &amp;cookie);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="tying-it-all-together">Tying it all together<a class="hash-link" href="#tying-it-all-together" title="Direct link to heading">​</a></h2><p>As any experienced developer knows, a huge part of writing code is defensive programming, guarding against potential errors. So be aware, for the sake of brevity, this tutorial has avoided addressing the myriad issues you may encounter.</p><p>That said, a more complete example can be found in the <a href="/opos/develop/datalogicoposexamples">Datalogic OPOS Examples</a>.</p><p>Refactoring a little, we can move shared #include and #import statements to a common location (ScaleSink.h in this tutorial).</p><div class="codeBlockContainer_I0IT language-c++ theme-code-block"><div class="codeBlockContent_wNvx c++"><pre tabindex="0" class="prism-code language-c++ codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ScaleSink.h</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;windows.h&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;string&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;iostream&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// For access to scale constants (e.g. SCAL_SN_ENABLED)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &quot;OposScal.h&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// This import statement causes generation of OPOSScale.tlh and OPOSScale.tli</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#import &quot;progid:OPOS.Scale&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// This import statement informs the IDE of the COM interface and everything in the</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// namespace OposScale_CCO, but is not required for compilation.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#import &quot;libid:ccb90170-b81e-11d2-ab74-0040054c3719&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Doing that simplifies the main file a little. Finally, we can add the code connecting the scale to the sink.<a name="together"></a></p><div class="codeBlockContainer_I0IT language-c++ theme-code-block"><div class="codeBlockContent_wNvx c++"><pre tabindex="0" class="prism-code language-c++ codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &quot;ScaleSink.h&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;processthreadsapi.h&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">static DWORD threadID;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">static BOOL handler(DWORD event);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Setup the console program to exit gracefully.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    threadID = GetCurrentThreadId();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SetConsoleCtrlHandler((PHANDLER_ROUTINE)(handler), TRUE);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Load and initialize the COM library.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CoInitializeEx(NULL, COINIT_APARTMENTTHREADED);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Create a COM object and point to it.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    OposScale_CCO::IOPOSScalePtr scale;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scale.CreateInstance(&quot;OPOS.Scale&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Open a context with the scale (e.g. &quot;USBScale&quot;).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    std::string profileName(&quot;&lt;your selected profile&gt;&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scale-&gt;Open(profileName.c_str());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Claim control of the scale using a 1000 millisecond timeout.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scale-&gt;ClaimDevice(1000L);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (scale-&gt;Claimed)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // The scale has been opened and claimed.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Enable the device.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        scale-&gt;DeviceEnabled = true;        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Tell the scale we intend to perform &quot;live&quot; weighing.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        scale-&gt;StatusNotify = SCAL_SN_ENABLED;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Enable transmission of event data.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        scale-&gt;DataEventEnabled = true;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Determine whether scale is connectable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        IConnectionPointContainer* cpc;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        bool isConnectable = (scale-&gt;QueryInterface(IID_IConnectionPointContainer, (void**)&amp;cpc) == S_OK);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (isConnectable)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // Determine whether _IOPOSScaleEvents connection point is supported.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            IConnectionPoint* cp;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            bool haveConnectionPoint = (cpc-&gt;FindConnectionPoint(__uuidof(OposScale_CCO::_IOPOSScaleEvents), &amp;cp) == S_OK);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            cpc-&gt;Release();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if (haveConnectionPoint)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                ScaleSink* sink = new ScaleSink(*scale);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                // Connect cp with sink (subscribe to the sink).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                // cookie is a token representing the connection,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                // used later when deleting the connection.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                DWORD cookie;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                cp-&gt;Advise(sink, &amp;cookie);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                std::cout &lt;&lt; &quot;Press \&#x27;Ctrl + C\&#x27; to quit.&quot; &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                // The scale message loop. Events will be handled by the methods of the sink.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                static MSG msg = { 0 };</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                while (GetMessage(&amp;msg, 0, 0, 0))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    TranslateMessage(&amp;msg);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    DispatchMessage(&amp;msg);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                // Delete the connection (unsubscribe from the sink).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                cp-&gt;Unadvise(cookie);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                cp-&gt;Release();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Disable, release and close the scale.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        scale-&gt;DeviceEnabled = false;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        scale-&gt;ReleaseDevice();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        scale-&gt;Close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Release the COM object</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scale.Release();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Unload libraries on this thread.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CoUninitialize();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BOOL handler(DWORD event)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    PostThreadMessage(threadID, WM_QUIT, 0, 0);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return TRUE;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/opos/develop/tutorialcppscanner"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">C++ Barcode Reader Tutorial</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/opos/develop/tutorialcsharpscanner"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">C# Barcode Reader Tutorial</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#creating-a-project" class="table-of-contents__link toc-highlight">Creating a project</a></li><li><a href="#exposing-opos-control-objects" class="table-of-contents__link toc-highlight">Exposing OPOS control objects</a></li><li><a href="#creating-the-opos-scale-interface" class="table-of-contents__link toc-highlight">Creating the OPOS scale interface</a></li><li><a href="#accessing-the-opos-scale-interface" class="table-of-contents__link toc-highlight">Accessing the OPOS Scale interface</a></li><li><a href="#creating-a-sink-for-the-scale" class="table-of-contents__link toc-highlight">Creating a sink for the scale</a></li><li><a href="#connecting-the-scale-and-the-sink" class="table-of-contents__link toc-highlight">Connecting the scale and the sink</a></li><li><a href="#tying-it-all-together" class="table-of-contents__link toc-highlight">Tying it all together</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Developer Links</div><ul class="footer__items"><li class="footer__item"><a href="https://developer.datalogic.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Developer Site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/datalogic" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Notices</div><ul class="footer__items"><li class="footer__item"><a href="http://www.datalogic.com/eng/legal-notice-pa-92.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Legal Notice</a></li><li class="footer__item"><a href="http://www.datalogic.com/eng/privacy-policy-pa-112.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy</a></li><li class="footer__item"><a href="http://www.datalogic.com/eng/terms-and-conditions-pa-93.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms and Conditions</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social Media</div><ul class="footer__items"><li class="footer__item"><a href="https://www.facebook.com/DatalogicGroup/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/DatalogicGroup" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/datalogic" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.youtube.com/user/DatalogicGroup" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Datalogic Inc.<br><br>Built with Docusaurus. All rights reserved. Datalogic and the Datalogic logo are registered trademarks of Datalogic S.p.A. in many countries including the U.S.A. and the E.U. All other trademarks are the property of their respective owners.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e2f337d0.js"></script>
<script src="/assets/js/main.ccfced16.js"></script>
</body>
</html>